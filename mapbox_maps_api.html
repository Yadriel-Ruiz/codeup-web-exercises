<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Map Box Exercise</title>
    <script src='https://api.mapbox.com/mapbox-gl-js/v3.0.0/mapbox-gl.js'></script>
    <link href='https://api.mapbox.com/mapbox-gl-js/v3.0.0/mapbox-gl.css' rel='stylesheet'/>
    <script src="https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-geocoder/v5.0.0/mapbox-gl-geocoder.min.js"></script>
    <link rel="stylesheet"
          href="https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-geocoder/v5.0.0/mapbox-gl-geocoder.css"
          type="text/css">
    <!--
    Redraw the map of the above location at zoom levels 5, 15, and 20. Do this by simply changing the value of zoom
    level where the map properties are initially set and refresh the page to see the changes. Can the zoom be changed
    programmatically after the initial map is drawn?
    -->
</head>
<body>

<div id='map' style='width: 80vw; height: 80vh;'></div>


<script src="js/keys.js"></script>
<script>

    // Creates the map
    mapboxgl.accessToken = MB_KEY;

    let restaurants = [
        {name: "Franks Pizza",
         coordinates: [-95.36260, 29.76139],
        announcement: "Welcome to Frank's Pizza"},
        {name: "Breakfast Klub",
         coordinates: [-95.38042, 29.73840],
        announcement: "Welcome to Breakfast Klub"},
        {name: "Rainbow Lodge",
         coordinates: [-95.42945, 29.80438],
        announcement: "Welcome to Rainbow Lodge"},
    ]

    const map = new mapboxgl.Map({

        container: 'map', // container ID
        style: 'mapbox://styles/mapbox/streets-v12', // style URL
        center: [-95.38042, 29.73840], // starting position Houston
        zoom: 11// starting zoom
    });

    //Adds a search bar to the map
    map.addControl(
        new MapboxGeocoder({
            accessToken: MB_KEY,
            mapboxgl: mapboxgl
        }));

    //Gives you zoom control on the map
    map.addControl(new mapboxgl.NavigationControl());

    //Refactored code to add the 3 restaurants
    restaurants.forEach((restaurant) => {
        const { name, coordinates, announcement } = restaurant;

        const marker = new mapboxgl.Marker()
            .setLngLat(coordinates)
            .addTo(map);

        const popup = new mapboxgl.Popup()
            .setHTML(`<p>${announcement}</p>`);

        marker.setPopup(popup);
    });

//Changing the zoom level using timeout in order for it to not continue repeating itself
    setTimeout(() => {
        map.setZoom(5);
    }, 2000);

    setTimeout(() => {
        map.setZoom(15);
    }, 4000);

    setTimeout(() => {
        map.setZoom(20);
    }, 6000);
</script>
</body>
</html>